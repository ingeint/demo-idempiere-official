pipeline {
    agent none
    environment {
        IDEMPIERE_REPOSITORY = "/idempiere"
        REGISTRY_PASS = credentials('ingeint-registry-pass')

    }
    stages {
        stage('Build Artefact') {
            agent {
                docker { 
                     image 'ubuntu:xenial'
                }
            }
            steps {
                sh 'docker login $REGISTRY_REPOSITORY -u $REGISTRY_USER -p $REGISTRY_PASS'
                sh 'docker run -d --name source portus.ingeint.com/idempiere-source sleep 60'
                sh 'rm -R source-idempiere'
                sh 'docker cp source:/idempiere/org.idempiere.p2/target/products/org.adempiere.server.product/linux/gtk/x86_64 ./source-idempiere '
                script{
                    zip archive: true, dir: 'source-idempiere', glob: '', zipFile: 'idempiereServer.gtk.linux.x86_64.zip'
                }
                sh 'docker rm -f source '
            }
        }
    }
}
